<script type="text/javascript">
    $("#NewOrderItem").ready(function() {
      orderID = <%= @order.id %>;
      $("#orderDetailShippingDate" ).datepicker();
      retrieveDataDetailView(orderID)
      if(<%= !@order.pre_order? %>) $(".payment-section").css("display","block");
      
});
</script>



<%= javascript_include_tag "angular/controller/orderController" %>
<%= javascript_include_tag "angular/controller/cartController" %>


<input type="hidden" disabled id="orderItemOrderID"  value="<%= @order.id %>" onload="retrieveDataDetailView(<%= @order.id %>)" />

<div id="NewOrderItem" ng-controller="NewOrderItemController" >
    
    <!-------------------------CUSTOMER-------------------------------> 
    <div class="row customer-section">
        <div class="col-md-2">
            
        </div>
        <div class="col-md-8 tabs">
           <button class="btn btn-danger back"><%= link_to 'Back', orders_path %></button>
            <div class="tabsView">
                <!--<div ng-include="currentTab"></div>-->
                <form class="form-horizontal" role="form" id="addNewCustomer">
                    
                    <div class="row">
                        <div class="col-md-2" >
                            <h2> Customer </h2>
                        </div>
                        <div class="col-md-10">
                            
                        </div>
                    </div>
                        
                     <div class="row">
                         <div class="col-md-2" >
                             Customer ID: 
                        </div> 
                            <div class="col-md-4 customer-biodata">
                             <select id="orderCustomerID" class="form-control" disabled>
                              <option value="">New Customer</option>
                    
                              <%= Customer.all.each do |customer| %>
                                <option value="<%= customer.id%>" <%= @order.customer_id == customer.id ? "selected" : ""%>><%= customer.id%> - <%= customer.customer_name%></option>
                              <% end %>
                             </select>
                         </div>
                    </div>
                     
                     <div class="row">
                         <div class="col-md-2" >
                             Customer Name: 
                        </div>
                         <div class="col-md-4 customer-biodata" >
                             <input type="text" class="form-control" id="orderCustomerName" value="<%= @customer.customer_name %>" disabled/>
                         </div>
                     </div>
                     
                     <div class=" row">
                         <div class="col-md-2" >
                             Customer Address:
                         </div>
                         
                         <div class="col-md-4 customer-biodata" >
                             <input type="text" class="form-control" id="orderCustomerAddress" value="<%= @customer.customer_address %>" disabled />
                         </div>                              
                         
                     </div>
                    
                    <div class="row">
                        
                         <div class="col-md-2" > 
                             Customer Phone: 
                         </div>
                         
                         <div class="col-md-4 customer-biodata" >
                                 <input type="text" class="form-control" id="orderCustomerPhone"  value="<%= @customer.customer_phone %>" disabled />
                         </div>                         
                    </div>
                     
                    <div class="row">
                        <div class="col-md-2" >
                         
                        </div>
                        <div class="col-md-4" >

                        </div>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
       
    <div class="row">
        <div class="col-md-2">
                
        </div>
        <div class="col-md-8 tabs">
            <div class="tabsView">
                <form role="form" id="addOrderItems">
                    
                    <div class="row">
                        <div class="col-md-2" >
                            <button id="up-to-customer" class="btn btn-info" onclick="upToCustomerSection()">
                                <i class="fa fa-caret-square-o-up" aria-hidden="true"></i> UP
                            </button>
                            <h2> Items </h2>
                        </div>
                        <div class="col-md-4">
                            
                        </div>
                    </div>    
                    <% if @order.pre_order? %>
                    <div class="row">
                        <div class="col-md-2" >
                            Bike Name: 
                        </div>
                        <div class="col-md-4 item-to-add">
                            <select id="orderItemProductID" class="form-control" onchange="getProductData()">
                            <option value="">Select Product</option>
                              <%= Product.all.order(:bike_name).each do |product| %>
                                <option value="<%= product.id%>"><%= product.bike_name%></option>
                              <% end %>
                            </select>
                        </div>
                        <div class="col-md-6 item-to-add">
                            <span id="order_item_product_id_header" style="color: red;" hidden>Product </span>
                            <span id="order_item_product_id_alert" style="color: red;"></span>
                        </div>
                    </div>   
    
                    <div class="row">
                        <div class="col-md-2" >
                            Price: 
                        </div>
                        <div class="col-md-4 item-to-add">
                            <input type="number" class="form-control" id="orderItemPrice" disabled/>
                        </div>
                        <div class="col-md-6 item-to-add">
                           
                        </div>
                    </div>   
    
                     <div class="row">
                        <div class="col-md-2" >
                            Qty: 
                        </div>
                        <div class="col-md-4 item-to-add">
                            <input type="number" class="form-control" id="orderItemQty" onchange="calculateTotalPrice()"/>
                        </div>
                        <div class="col-md-6 item-to-add">
                            <span id="order_item_qty_header" style="color: red;" hidden>Qty </span>
                            <span id="order_item_qty_alert" style="color: red;"></span>
                        </div>
                    </div>   
    
                     <div class="row">
                        <div class="col-md-2" >
                            Total Price: 
                        </div>
                        <div class="col-md-4 item-to-add">
                            <input type="number" class="form-control" id="orderItemTotalPrice" disabled/>
                        </div>
                        <div class="col-md-6 item-to-add">
                           
                        </div>
                    </div>   
                    
                    <div class="row">
                        <div class="col-md-2" >
                            
                        </div>
                        <div class="col-md-4 item-to-add">
                          <input type="button" value="Add To Cart" id="orderItemAddToCart" class="btn btn-success" onclick="addToCart(); calculateGrandTotal();" >
                        </div>
                        <div class="col-md-6 item-to-add">
                           
                        </div>
                    </div>   
                    <% end %>
                     <div class="row" ng-controller="NewOrderItemController" >
                        <div class="col-md-12" >
                            
                          <div id="table-responsive-custom">
                            <table summary="This table shows file inside database" class="table table-bordered table-hover">
                              <caption class="text-center">{{title}}</caption>
                              <thead>
                                <tr>
                                  <th>Product Name</th> 
                                  <th>Price</th>
                                  <th>Qty</th>
                                  <th>Current Qty</th>
                                  <th>Total Price</th>
                                  <th>Action</th>
                                </tr>
                              </thead>
                              <tbody  class="cart-item">
     
                            </tbody>
                            <tfoot>
                              <tr>
                                <td colspan="5" class="text-center">Customer Cart</td>
                              </tr>
                            </tfoot>
                          </table>
                        </div><!--end of .table-responsive-->
                            <div style="text-align:right;"><h4>Grand Total:<span class="grand-total"></span></h4></div>
                            <% if @order.pre_order? %>
                            <input type="button" name="Save Order" id="saveOrderButton" value="Save" class="btn btn-success" onclick="saveOrderInformation()">
                            <input type="button" name="Confirm Order" id="confirmOrderButton" value="Next" class="btn btn-success" onclick="confirmOrder()">
                            <% end %>
                        </div>
                    </div> 
              </form>
            </div>
        </div>
        <div class="col-md-2">
            
        </div>
    </div>


    <div class="row payment-section">
        <div class="col-md-2">
                
        </div>
        <div class="col-md-8 tabs">
            <div class="tabsView">
                <form role="form" id="payment">
                    
                    <div class="row">
                        <div class="col-md-8" >
                            <button id="up-to-customer" class="btn btn-info" onclick="upToItemSection()">
                                <i class="fa fa-caret-square-o-up" aria-hidden="true"></i> UP
                            </button>
                            <h2> Payment & Delivery </h2>
                        </div>
                        <div class="col-md-4">
                            
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-2" >
                            Shipping Address
                        </div>
                        <div class="col-md-4 payment-shipping-section">
                            <input type="text" class="form-control" id="orderDetailsShippingAddress" value="<%= @order.shipping_address%>" required/>
                        </div>
                        <div class="col-md-6 payment-shipping-section">
                           
                        </div>
                    </div> 
                    
                     <div class="row">
                        <div class="col-md-2" >
                            Shipping Method
                        </div>
                        <div class="col-md-4 payment-shipping-section">
                            <select id="orderDetailShippingMethod" class="form-control">
                              
                                 <option value="">Select Shipping Method</option>

                                 <option value="on_the_spot" <%= @order.on_the_spot? ? "Selected" : ""%>> On The Spot</option>
                                 <option value="delivery" <%= @order.delivery? ? "Selected" : ""%>> Delivery</option>
                                 
                            </select>
                        </div>
                        <div class="col-md-6 payment-shipping-section">
                           
                        </div>
                    </div> 
                    
                    <div class="row">
                        <div class="col-md-2" >
                            Shipping Date 
                                             
                        </div>
                        <div class="col-md-4 payment-shipping-section">
                            <input type="text" class="form-control" id="orderDetailShippingDate" value="<%= @order.shipping_date %>" required/>
                        </div>
                        <div class="col-md-6 payment-shipping-section">
                           
                        </div>
                    </div> 
                    
                     <div class="row">
                        <div class="col-md-2" >
                            
                        </div>
                        <div class="col-md-10 payment-shipping-section">
                            <% if(!@order.is_paid) %>
                            <button class="btn btn-success confirm-payment" data-toggle="modal" data-target="#paymentConfirm" >Confirm payment</button>
                            <% else %>
                            <button class="btn btn-success confirm-payment" onclick="generateInvoice(<%= @order.id %>)">Generate Invoice</button>
                            <% end %>
                            
                            <% if(!@order.is_delivered) %>
                            <button class="btn btn-warning confirm-delivery" data-toggle="modal" data-target="#deliveryConfirm">Confirm delivery</button>
                            <% else %>
                            <button class="btn btn-warning confirm-delivery" onclick="generateLetterOfTravel(<%= @order.id %>)">Generate Letter of Travel</button>
                            <% end %>
                            <button class="btn btn-primary save" onclick="saveOrderInformation()">Save</button>
                        </div>
                        
                    </div> 
                    
                </form>
            </div>
        </div>
        <div class="col-md-2">
            
        </div>
    </div>

</div>
 

<div class="modal fade" id="paymentConfirm" tabindex="-1" role="dialog" aria-labelledby="paymentConfirmLabel">
    <div class="modal-dialog vertical-align-center" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Payment Confirmation</h4>
        </div>
        <div class="modal-body">
          ARE YOU FUCKING SURE HAD RETRIEVED THE MONEY ??
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="confirmPayment()">Yes</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="deliveryConfirm" tabindex="-1" role="dialog" aria-labelledby="deliveryConfirmLabel">
    <div class="modal-dialog vertical-align-center" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Delivery Confirmation</h4>
        </div>
        <div class="modal-body">
          ARE YOU FUCKING SURE HAD SENT THE BIKE ??
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="confirmDelivery()">Yes</button>
        </div>
      </div>
    </div>
  </div>
  
<script>
    var date = new Date($("#orderDetailShippingDate").val());

    $("#orderDetailShippingDate").val(dateFormat(date, "mm/dd/yyyy"));
</script>
